<div class="container my-4">
  <h3 class="fw-bold text-center mb-4"><%= @orden_trabajo.clinom.presence || "Nueva Orden de Trabajo" %></h3>

  <%= simple_form_for @orden_trabajo do |f| %>
    <%= f.error_notification %>

    <div class="row g-3">
      <div class="col-md-6">
        <%= f.input :clinom, label: "Cliente" %>
      </div>
      <div class="col-md-6">
        <%= f.input :nomprod, label: "Producto" %>
      </div>
    </div>

    <div class="row g-3 mt-2">
      <div class="col-md-2">
        <%= f.input :trnum, label: "N° OT" %>
      </div>
      <div class="col-md-2">
        <%= f.input :trcan, label: "Cantidad" %>
      </div>
      <div class="col-md-2">
        <%= f.input :papel, label: "Papel" %>
      </div>
      <div class="col-md-2">
        <%= f.input :colores, label: "Colores" %>
      </div>
      <div class="col-md-2">
        <%= f.input :gramaje, label: "Gramaje" %>
      </div>
    </div>

    <div class="row g-3 mt-4">
      <div class="col-md-3">
        <%= f.input :pliego, label: "Pliego" %>
      </div>
      <div class="col-md-3">
        <%= f.input :trcar, as: :date, html5: true, label: "Fecha Ingreso" %>
      </div>
      <div class="col-md-3">
        <%= f.input :deadline, as: :date, html5: true, label: "Fecha Prometida",
                     input_html: { value: f.object.deadline || (Date.today + 15.days) } %>
      </div>
      <div class="col-md-3">
        <%= f.input :priority, as: :select,
                     collection: ["Alta", "Media", "Baja"],
                     label: "Prioridad",
                     include_blank: "Seleccionar" %>
      </div>
    </div>

    <div class="mt-4">
      <%= f.input :observaciones, label: "Observaciones", input_html: { rows: 4 } %>
    </div>

    <div class="text-center mt-4">
      <%= f.button :submit, "Confirmar", class: "btn btn-primary btn-lg px-5" %>
    </div>
  <% end %>
</div>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Inicializa el multiselect solo si el plugin está disponible
    const multiselect = $("#orden_trabajo_procesos_<%= @orden_trabajo.id %>");
    if (multiselect.length && typeof multiselect.multiselect === "function") {
      multiselect.multiselect({ allSelectedText: "Todos seleccionados" });
    }

    // Sincroniza el valor seleccionado con el campo oculto (si existe)
    multiselect.on("change", function() {
      const valor = $(this).val();
      $(`#<%= @orden_trabajo.id %>`).val(valor);
    });

    // Inicializa datepicker de Bootstrap 5 o jQuery UI si está cargado
    if (typeof $.fn.datepicker === "function") {
      $(".datepicker").datepicker({
        format: "dd-mm-yyyy",
        todayHighlight: true,
        autoclose: true
      });
    }
  });
</script>

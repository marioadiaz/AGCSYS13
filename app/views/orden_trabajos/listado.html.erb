<p id="notice"><%= notice %></p>

<div class="d-flex justify-content-between align-items-center mb-4 px-3 flex-wrap">
  <!-- 🏭 Título -->
  <div class="me-4">
    <h3 class="mb-0 fw-bold">Listado de trabajos en el Taller</h3>
  </div>
  <!-- 💡 Script de búsqueda -->
  <script type="module">
    document.addEventListener("turbo:load", () => {
      const $buscador = $("#buscador_datos");
      const $filas = $("#TablaOrdenesTrabajos tr");

      if ($buscador.length && $filas.length) {
        $buscador.on("keyup", function() {
          const value = $(this).val().toLowerCase().trim();

          $filas.each(function() {
            const textoFila = $(this).text().toLowerCase();
            $(this).toggle(textoFila.includes(value));
          });
        });
      }
    });
  </script>
  <!-- 🔍 Buscador -->
  <div class="flex-grow-1 text-center">
    <input class="form-control d-inline-block w-50"
           id="buscador_datos"
           type="text"
           placeholder="Buscar trabajo...">
  </div>
  <!-- 📄 Botón PDF -->
  <div class="ms-3">
    <%= link_to 'Descargar PDF',
                listado_path(format: 'pdf'),
                class: 'btn btn-success btn-lg',
                target: '_blank' %>
  </div>
  <!-- Botón Descargar Excel -->  
  <div class="ms-2">
    <%= link_to 'Descargar Excel',
            listado_path(format: 'xlsx'),
            class: 'btn btn-warning btn-lg',
            target: '_blank' %>
  </div>          
  <!-- 📊 Botón Importar Excel -->
  <div class="ms-2">
    <%= link_to '📥 Importar Excel',
            orden_trabajos_imports_new_path,
            class: 'btn btn-primary btn-lg' %>
  </div>
<!-- Botón para volver arriba -->
<button onclick="topFunction()" id="myBtn" title="Volver arriba"
        class="btn btn-danger shadow fw-bold text-white"
        style="display:none; position:fixed; bottom:40px; right:40px; z-index:9999;
               border-radius:8px; padding:10px 20px; font-size:16px;">
  Tira Mi Su
</button>
<!-- 📋 Tabla principal -->
<table class="table table-striped m-2">
  <thead>
    <tr>
      <th>OT</th>
      <th>Cliente</th>
      <th>Producto</th>
      <th>Cantidad</th>
      <th>Observaciones</th>
      <th>Estado actual</th>
      <th>Procesos</th>
      <th>Fecha entrada</th>
      <th>Fecha entrega</th>
      <th></th>
    </tr>
  </thead>
  <tbody id="TablaOrdenesTrabajos">
    <% @orden_trabajos.each do |orden_trabajo| %>
      <tr>
        <td><%= link_to orden_trabajo.trnum, orden_trabajo %></td>
        <td><%= link_to orden_trabajo.clinom, orden_trabajo %></td>
        <td><%= link_to orden_trabajo.nomprod, orden_trabajo %></td>
        <td><%= orden_trabajo.trcan %></td>
        <td><%= truncate(orden_trabajo.observaciones, length: 50) %></td>
        <td><%= orden_trabajo.estado_actual %></td>
        <td><%= orden_trabajo.procesos %></td>
        <td><%= orden_trabajo.trcar.try(:strftime, "%e %B") %></td>
        <td><%= orden_trabajo.deadline.try(:strftime, "%e %B") %></td>
        <td class="text-center">
          <%= link_to '',
                      orden_trabajo,
                      method: :delete,
                      data: { confirm: '¿Estás seguro/a?' },
                      remote: true,
                      class: 'delete_ot btn-lg glyphicon glyphicon-trash text-danger' %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
<!-- ⚙️ Scripts -->
<script>
  // --- Botón "Ir arriba" ---
  const mybutton = document.getElementById("myBtn");

  window.onscroll = function() {
    scrollFunction();
  };

  function scrollFunction() {
    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
      mybutton.style.display = "block";
    } else {
      mybutton.style.display = "none";
    }
  }

  function topFunction() {
    document.body.scrollTop = 0; // Safari
    document.documentElement.scrollTop = 0; // Chrome, Firefox, IE, Opera
  }
</script>
